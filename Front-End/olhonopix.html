<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>De Olho no Pix ‚Äî In√≠cio (H√≠brido)</title>
  <meta name="description" content="Prot√≥tipo educativo para prevenir golpes no Pix: den√∫ncia, pesquisa e orienta√ß√µes." />
  <meta name="theme-color" content="#0f172a" />
  <link rel="icon" href="DeOlhoNoPix%20imagem%201.png">
  <style>
    :root{
      --brand-primary:#dff4ff;
      --brand-secondary:#2f7a25;
      --brand-secondary-grad:#6eaa5e;
      --brand-accent:#007bff;
      --bg:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --card:#ffffff;
      --border:#e2e8f0;
      --ok:#2e7d32;
      --warn:#ff9800;
      --amber:#fbbf24;
      --danger:#dc2626;
      --focus:#2563eb;
      --max:95%; /* Largura m√°xima aumentada */
      --shadow:none;
    }

    /* üî¶ Modo escuro vis√≠vel */
    body.dark{
      --bg:#0b1120;
      --text:#e2e8f0;
      --card:#1e293b;
      --border:#334155;
      --brand-primary:#1e3a8a;
      --brand-secondary:#10b981;
      --brand-secondary-grad:#34d399;
      --brand-accent:#60a5fa;
      --muted:#94a3b8;
      --focus:#3b82f6;
      --warn:#f59e0b;
      --amber:#fbbf24;
      --danger:#ef4444;
    }
    body.dark header{ background:linear-gradient(90deg,#1e293b,#0f172a); border-bottom-color:#334155; }
    body.dark nav.topnav a:hover,
    body.dark nav.topnav a[aria-current="page"]{ background:#1e293b; border-color:#475569; }
    body.dark .btn-tool:hover{ background:#334155; }
    body.dark thead th{ background:#0f172a; color:#c7d2fe; }

    /* ‚ôø Modo dalt√¥nico escuro (acess√≠vel) */
    body.daltonico{
      --bg:#0a0a0a;
      --text:#f5f7fb;
      --card:#141414;
      --border:#2a2a2a;
      --brand-primary:#0ea5e9;
      --brand-secondary:#f59e0b;
      --brand-secondary-grad:#fbbf24;
      --brand-accent:#a78bfa;
      --muted:#cbd5e1;
      --focus:#22d3ee;
      --ok:#22d3ee;
      --warn:#f59e0b;
      --amber:#fde047;
      --danger:#e11d48;
    }
    body.daltonico header{ background:linear-gradient(90deg,#111827,#0a0a0a); border-bottom-color:#2a2a2a; }
    body.daltonico nav.topnav a:hover,
    body.daltonico nav.topnav a[aria-current="page"]{ background:#111827; border-color:#374151; }
    body.daltonico .btn-tool,
    body.daltonico #btn-dark,
    body.daltonico #btn-contrast{ background:#141414; color:#f5f7fb; border:1px solid #374151; }
    body.daltonico .btn-tool:hover, body.daltonico #btn-dark:hover, body.daltonico #btn-contrast:hover{ filter:brightness(1.05); }
    body.daltonico thead th{ background:#111827; color:#93c5fd; }
    body.daltonico .btn{ border-color:#374151; background:#141414; color:#f5f7fb; }
    body.daltonico .btn:hover{ filter:brightness(1.05); }
    body.daltonico .btn.ghost{ background:#141414; color:#f5f7fb; }
    body.daltonico .btn.primary{ background:linear-gradient(135deg, var(--brand-accent), #7c93ff); color:#0b0b0b; }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,"Helvetica Neue",Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      transition:background .25s,color .25s;
    }
    a{color:inherit;text-decoration:none}
    .app{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}

    .sr-only{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip:focus{left:12px;top:12px;width:auto;height:auto;background:#fff;color:#000;padding:.5rem .75rem;border-radius:.5rem;z-index:1000}

    header{background:linear-gradient(90deg, var(--brand-primary), #eef9ff 40%, #e7ffe7 120%); border-bottom:1px solid var(--border)}
    .topbar{max-width:var(--max); margin:0 auto; display:flex; align-items:center; gap:16px; padding:14px 20px}
    .brand{display:flex; align-items:center; gap:12px}

    nav.topnav{margin-left:auto; display:flex; gap:10px; flex-wrap:wrap}
    nav.topnav a{padding:10px 14px; border-radius:12px; border:1px solid transparent; font-weight:700}
    nav.topnav a[aria-current="page"], nav.topnav a:hover{background:#ffffff55; border-color:var(--border)}

    .tools{display:flex; gap:10px; flex-wrap:wrap; margin-left:8px}
    .btn-tool{ border:1px solid var(--border); background:var(--card); border-radius:12px; padding:8px 12px; cursor:pointer; display:inline-flex; align-items:center; gap:6px; font-size:14px; font-weight:600 }
    .btn-tool:hover{background:#f1f5f9}

    .container{max-width:var(--max); margin:0 auto; padding:36px 24px}
    main{min-height:60vh}

    .card{background:transparent; border:none; border-radius:0; padding:0; box-shadow:none}
    .card h1,.card h2{margin:0 0 10px 0}
    .muted{color:var(--muted)}

    .badge{display:inline-block; padding:.25rem .5rem; border-radius:999px; font-size:12px; border:1px solid var(--border)}
    .req{ color:#dc2626; font-weight:700; margin-left:2px }

    .grid{display:grid; gap:20px}
    .grid.two{grid-template-columns:repeat(2,1fr)}
    .grid.responsive{grid-template-columns:repeat(auto-fit,minmax(320px,1fr))}

    /* --- COLE ISTO NO LUGAR DO SEU CSS DE INPUTS ATUAL --- */

    /* Container do formul√°rio */
    form {
        display: grid;
        gap: 32px; /* Espa√ßo vertical entre os campos */
        width: 100%;
    }

    /* Linhas com duas colunas */
    .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px; /* Espa√ßo horizontal */
    }

    /* Configura√ß√£o dos Campos (Grandes e Largos) */
    input, select {
        display: block;           /* Comporta-se como bloco */
        width: 400px;              /* OBRIGAT√ìRIO: Preenche a largura do pai */
        box-sizing: border-box;   /* Garante que padding n√£o estoure */
        padding: 12px 18px;       /* Altura interna maior */
        font-size: 16px;          /* Letra maior */
        min-height: 20px;         /* Altura m√≠nima fixa */
        line-height: 1.5;        /* Espa√ßamento entre linhas */
        border: 1px solid var(--border);
        border-radius: 12px;
        background: var(--card);
        color: var(--text);
        font-family: inherit;
        resize: vertical;
        transition: border-color .2s, box-shadow .2s;
    }

    /* Remove borda azul feia e p√µe sombra suave */
    input:focus, select:focus {
        outline: none;
        border-color: var(--focus);
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
    }

    textarea {
        display: block;
        width: 100%;
        box-sizing: border-box;
        
        /* --- TAMANHO FIXO E GRANDE --- */
        height: 180px;            /* Altura fixa bem grande (ajuste como quiser) */
        padding: 20px;            /* Espa√ßo interno em todos os lados */
        line-height: 1.5;         /* Espa√ßamento entre linhas de texto */
        font-size: 16px;
        /* ----------------------------- */

        /* Visual */
        border: 1px solid var(--border);
        border-radius: 12px;
        background: var(--card);
        color: var(--text);
        font-family: inherit;
        
        /* Comportamento de redimensionamento */
        resize: none;             /* TRAVA TOTALMENTE (n√£o deixa o usu√°rio mudar o tamanho) */
        /* OU use: resize: vertical; (se quiser deixar o usu√°rio aumentar pra baixo) */
        
        transition: border-color .2s, box-shadow .2s;
    }
    
    /* Foco (para ficar azul quando clica) */
    textarea:focus {
        outline: none;
        border-color: var(--focus);
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
    }
    
    /* Estado Desabilitado */
    input:disabled {
        background: #f1f5f9;
        cursor: not-allowed;
        opacity: 0.7;
    }
    body.dark input:disabled { background: #334155; }

    /* Labels (Posi√ß√£o relativa para o erro flutuar nela) */
    label {
        display: flex; 
        flex-direction: column; 
        gap: 8px;
        font-weight: 600; 
        font-size: 14px;
        position: relative; /* OBRIGAT√ìRIO para o erro flutuar */
        margin-bottom: 0;
    }

    /* MENSAGEM DE ERRO FLUTUANTE */
    .error {
        display: none;
        color: #dc2626;
        font-size: 12px; 
        font-weight: 500;
        
        /* A M√°gica: Flutua "por cima" sem empurrar nada */
        position: absolute; 
        bottom: -22px; /* Fica 22px abaixo do label (embaixo do input) */
        left: 4px;
        white-space: nowrap; 
        z-index: 10;
        pointer-events: none;
    }
    
    .error.show { 
        display: block; 
        animation: fadeIn .2s ease-out; 
    }
    
    /* Borda vermelha no campo */
    .field-error { 
        border-color: #dc2626 !important; 
        background-color: rgba(220,38,38,0.02) !important; 
    }

    @keyframes fadeIn { from{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}
    
    /* Ajuste para Mobile */
    @media (max-width: 768px) {
        .row { grid-template-columns: 1fr; } /* Vira uma coluna s√≥ no celular */
    }
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .btn{border:1px solid var(--border); background:var(--card); border-radius:14px; padding:12px 16px; cursor:pointer; display:inline-flex; align-items:center; gap:8px; font-weight:700; transition:filter .2s}
    .btn.primary{background:linear-gradient(135deg, var(--brand-accent), #60a5fa); color:#fff; border-color:transparent}
    .btn.primary:hover{filter:brightness(0.95)}
    .btn.success{background:linear-gradient(135deg, var(--brand-secondary-grad), #a7f3d0); color:#064e3b; border-color:transparent}
    .btn.ghost{background:var(--card)}

    section.page{display:none; padding:0}
    section.page.active{display:block}

    /* CTA tiles (hub) */
    .cta-tile{padding:28px; display:grid; gap:8px; place-content:center; text-align:center; border-radius:18px; background:linear-gradient(135deg,#fff,#f7fbff)}
    .cta-tile:hover{outline:3px solid var(--brand-accent); outline-offset:2px}
    .cta-title{font-size:22px; font-weight:800; color:#0b3b7a}

    /* Pesquisar */
    .search-wrap{max-width:1100px; margin:0 auto; display:grid; gap:16px}
    .search-controls{ display:grid; gap:10px }
    .search-input{ width:100%; }
    .suggestions{ position:relative }
    .suggestions-list{ position:absolute; top:100%; left:0; right:0; background:var(--card); border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); z-index:20; display:none; max-height:220px; overflow:auto }
    .suggestions-list.show{ display:block }
    .suggestion-item{ padding:10px 12px; cursor:pointer; border-bottom:1px solid var(--border); font-size:14px }
    .suggestion-item:last-child{ border-bottom:none }
    .suggestion-item:hover{ background:#f1f5f9 }

    /* Tabela */
    table{width:100%; border-collapse:separate; border-spacing:0; background:var(--card); border-radius:16px; overflow:hidden}
    th,td{padding:16px; text-align:left; border-bottom:1px solid var(--border); font-size:14px}
    thead th{background:#eef6ff; color:#0b3b7a; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; font-size:12px}
    tr:last-child td{border-bottom:none}
    tr.risk-5 td:first-child{box-shadow:inset 4px 0 0 var(--warn)}
    tr.risk-10 td:first-child{box-shadow:inset 4px 0 0 var(--amber)}
    tr.risk-15 td:first-child{box-shadow:inset 4px 0 0 var(--danger)}
    tr.risk-5{background:rgba(245,158,11,.06)}
    tr.risk-10{background:rgba(251,191,36,.10)}
    tr.risk-15{background:rgba(220,38,38,.08)}

    footer{border-top:1px solid var(--border); background:var(--card)}
    .foot{max-width:var(--max); margin:0 auto; padding:16px 20px; color:#666; font-size:14px; display:flex; justify-content:center; align-items:center; gap:16px; text-align:center}

    .toast{position:fixed; left:50%; bottom:24px; transform:translate(-50%, 120%); background:#0ea5e9; color:#fff; padding:12px 16px; border-radius:12px; font-weight:700; transition:transform .35s ease, opacity .35s ease; opacity:0; z-index:9999}
    .toast.show{transform:translate(-50%, 0); opacity:1}
    .toast.success{ background: #16a34a }
    .toast.error{ background: #dc2626 }

    .legend{ display:flex; gap:10px; flex-wrap:wrap; margin:16px 0 }

    @media (max-width: 1024px){ .grid.two{grid-template-columns:1fr} }
    @media (max-width: 900px){ .row{grid-template-columns:1fr} }
    @media (prefers-reduced-motion: reduce){ *{scroll-behavior:auto} }
  </style>
</head>
<body>
  <a href="#main" class="skip">Pular para o conte√∫do</a>
  <div class="app">
    <header role="banner" aria-label="Topo do site">
      <div class="topbar">
        <div class="brand" aria-label="Identidade do site">
          <img src="DeOlhoNoPix%20imagem%201.png" alt="Logotipo De Olho no Pix" style="height:44px; width:auto; border-radius:12px">
          <div>
            <div style="font-weight:900; font-size:18px">De Olho no Pix</div>
            <div class="muted" style="font-size:12px">Serenidade e preven√ß√£o a golpes</div>
          </div>
        </div>
        <nav class="topnav" aria-label="Navega√ß√£o principal (topo)">
          <a data-route href="#/hub">In√≠cio</a>
          <a data-route href="#/denunciar">Denunciar</a>
          <a data-route href="#/pesquisar">Pesquisar</a>
          <a data-route href="#/faq">FAQ</a>
          <a data-route href="#/perfil" style="display:none" id="nav-perfil">Perfil</a>
        </nav>
        <div class="tools" aria-label="Ferramentas de acessibilidade e tema">
          <button id="btn-contrast" class="btn-tool" title="Alternar modo dalt√¥nico">Acessibilidade</button>
          <button id="btn-dark" class="btn-tool" title="Alternar modo escuro">Modo Escuro</button>
        </div>
      </div>
    </header>

    <div class="container">
      <main id="main" role="main" class="grid" style="gap:24px">
        <section id="inicio" class="page card active" aria-labelledby="h-inicio">
          <h1 id="h-inicio">Entrar</h1>
          <form id="form-login" aria-describedby="d-inicio" style="max-width:800px; margin:0 auto" novalidate>
            <span id="d-inicio" class="sr-only">Campos de e-mail e senha. Links para recuperar senha e cadastrar-se.</span>
            <label>
              <span>E-mail<span class="req">*</span></span>
              <input id="login-email" type="email" required placeholder="Digite seu e-mail" autocomplete="username" aria-invalid="false" />
              <small class="error" id="err-login-email" aria-live="polite">Campo obrigat√≥rio. Informe um e-mail v√°lido.</small>
            </label>
            <label>
              <span>Senha<span class="req">*</span></span>
              <input id="login-pass" type="password" required placeholder="Digite sua senha" autocomplete="current-password" minlength="6" aria-invalid="false" />
              <small class="error" id="err-login-pass" aria-live="polite">Campo obrigat√≥rio. M√≠nimo de 6 caracteres.</small>
            </label>
            <div class="actions" style="justify-content:center">
              <button class="btn primary" type="submit" aria-label="Entrar e ir para In√≠cio">Entrar</button>
              <a class="btn ghost" data-route href="#/recuperar">Esqueci minha senha</a>
              <a class="btn success" data-route href="#/cadastro">Cadastrar-se</a>
            </div>
          </form>
        </section>

        <section id="cadastro" class="page card" aria-labelledby="h-cadastro">
          <h1 id="h-cadastro">Cadastrar-se</h1>
          <p class="muted">Leva menos de dois minutos. Campos com <span class="req">*</span> s√£o obrigat√≥rios.</p>
          <form id="form-cadastro" style="max-width:980px; margin:0 auto" novalidate>
            <div class="row">
              <label>
                <span>Nome completo<span class="req">*</span></span>
                <input id="cad-nome" type="text" required placeholder="Ex.: Maria de Souza" aria-invalid="false" />
                <small class="error" aria-live="polite">Informe seu nome completo.</small>
              </label>
              <label>
                <span>CPF<span class="req">*</span></span>
                <input id="cpf" type="text" required inputmode="numeric" pattern="\d{3}\.\d{3}\.\d{3}-\d{2}" placeholder="000.000.000-00" aria-invalid="false" />
                <small class="hint">Apenas n√∫meros ‚Äî a formata√ß√£o aparece sozinha.</small>
                <small class="error" aria-live="polite">Digite no formato 000.000.000-00.</small>
              </label>
            </div>
            <div class="row">
              <label>
                <span>N√∫mero de telefone<span class="req">*</span></span>
                <input id="tel" type="tel" required inputmode="tel" placeholder="(00) 00000-0000" aria-invalid="false" />
                <small class="error" aria-live="polite">Informe um telefone v√°lido.</small>
              </label>
              <label>
                <span>E-mail<span class="req">*</span></span>
                <input id="cad-email" type="email" required placeholder="voce@exemplo.com" aria-invalid="false" />
                <small class="error" aria-live="polite">E-mail inv√°lido.</small>
              </label>
            </div>
            <label>
              <span>Senha<span class="req">*</span></span>
              <input id="cad-pass" type="password" required minlength="6" placeholder="Crie uma senha segura" aria-invalid="false" />
              <small class="error" aria-live="polite">M√≠nimo de 6 caracteres.</small>
            </label>
            <div class="actions" style="justify-content:center">
              <button class="btn primary" type="submit">Confirmar cadastro</button>
            </div>
          </form>
        </section>

        <section id="hub" class="page card" aria-labelledby="h-hub">
          <h1 id="h-hub">Selecione uma op√ß√£o:</h1>
          <p class="muted">Escolha a op√ß√£o desejada abaixo.</p>
          <div class="grid two" style="max-width:1100px; margin:0 auto">
            <a class="cta-tile" data-route href="#/denunciar" aria-label="Ir para Realizar uma den√∫ncia" style="background:linear-gradient(135deg,#fff,#e8fff0)">
              <div class="cta-title">Realizar uma den√∫ncia</div>
              <div class="muted">Denunciar chave Pix suspeita</div>
            </a>
            <a class="cta-tile" data-route href="#/pesquisar" aria-label="Ir para Pesquisar" style="background:linear-gradient(135deg,#fff,#eef6ff)">
              <div class="cta-title">Quero pesquisar</div>
              <div class="muted">chave para verificar poss√≠veis irregularidades.</div>
            </a>
          </div>
        </section>

        <section id="denunciar" class="page card" aria-labelledby="h-denunciar">
          <h1 id="h-denunciar">Realizar uma den√∫ncia</h1>
          <p class="muted">Insira os dados da conta utilizada pelo golpista</p>
          
          <form id="form-denuncia" style="max-width:100%; margin:0 auto" novalidate>
            
            <div class="row">
              <label>
                <span>Tipo de chave Pix<span class="req">*</span></span>
                <select id="tipo" required>
                  <option value="">Selecione...</option>
                  <option>CPF</option>
                  <option>CNPJ</option>
                  <option>Telefone</option>
                  <option>E-mail</option>
                  <option>Chave aleat√≥ria</option>
                </select>
                <small class="error">Selecione um tipo.</small>
              </label>
              <label>
                <span>Nome do Titular<span class="req">*</span></span>
                <input id="nome" type="text" required placeholder="Nome como aparece no banco" />
                <small class="error">Informe o nome da conta.</small>
              </label>
            </div>
            
            <div class="row">
              <label>
                <span>Chave Pix<span class="req">*</span></span>
                <input id="chave_pix" type="text" required disabled placeholder="Selecione o tipo primeiro" autocomplete="off" />
                <small id="err-chave" class="error">Chave inv√°lida.</small>
              </label>
              <label>
                <span>CPF/CNPJ Parcial<span class="req">*</span></span>
                <input id="docparcial" type="text" required placeholder="***.123.456-**" />
                <small class="error">Documento obrigat√≥rio.</small>
              </label>
            </div>

            <div class="row">
              <label>
                <span>Ag√™ncia</span>
                <input id="ag" type="text" placeholder="0000" />
              </label>
              <label>
                <span>Conta</span>
                <input id="cc" type="text" placeholder="12345-6" />
              </label>
            </div>

            <div class="row">
              <label>
                <span>Banco<span class="req">*</span></span>
                <input id="banco" type="text" required placeholder="Ex: Nubank, Ita√∫..." />
                <small class="error">Informe o banco.</small>
              </label>
              <label>
                <span>N√∫mero do B.O.<span class="req">*</span></span>
                <input id="bo" type="text" required placeholder="2025..." />
                <small class="error">B.O. obrigat√≥rio.</small>
              </label>
            </div>
            
            <div class="row">
              <label>
                <span>Valor do Golpe (R$)</span>
                <input id="valor" type="text" placeholder="0,00" />
              </label>

              <label>
                <span>Comprovante / B.O. (PDF/Img)<span class="req">*</span></span>
                <input id="bo-file" type="file" accept=".pdf,.jpg,.jpeg,.png" required style="padding:12px; height:auto;" />
                <small class="error">Anexo obrigat√≥rio.</small>
              </label>
            </div>

            <label>
              <span>Relato do ocorrido</span>
              <textarea id="desc" rows="6" placeholder="Descreva o que aconteceu..."></textarea>
            </label>

            <div class="actions" style="justify-content:center">
              <button class="btn primary" type="submit">Confirmar Den√∫ncia</button>
            </div>
          </form>        
        </section>

        <section id="pesquisar" class="page card" aria-labelledby="h-pesquisar">
          <h1 id="h-pesquisar">Pesquisar den√∫ncias</h1>

          <div class="search-wrap">
            <div class="search-controls">
              <label style="max-width:420px">
                <span>Tipo de chave Pix</span>
                <select id="filtro-tipo">
                  <option value="">Todos os tipos</option>
                  <option>E-mail</option>
                  <option>Telefone</option>
                  <option>CPF</option>
                  <option>CNPJ</option>
                  <option>Chave aleat√≥ria</option>
                </select>
              </label>

              <div class="suggestions">
                <input id="q" class="search-input" type="search" placeholder="Digite sua busca (tipo, nome, banco, BO...)" aria-autocomplete="list" aria-controls="sug-list" aria-expanded="false" />
                <div id="sug-list" class="suggestions-list" role="listbox" aria-label="Sugest√µes"></div>
              </div>
              <div class="actions">
                <button id="btn-buscar" class="btn primary" type="button">Buscar</button>
                <button id="btn-limpar" class="btn ghost" type="button">Limpar</button>
              </div>
            </div>

            <div class="legend">
              <strong>Legenda:</strong>
              <span class="badge" style="background:var(--warn)">5 Risco de golpe</span>
              <span class="badge" style="background:var(--amber)">10 Grave risco de golpe</span>
              <span class="badge" style="background:var(--danger); color:#fff">15 Grav√≠ssimo risco de golpe</span>
              <span class="badge">&lt;5 Baixo risco</span>
            </div>

            <div style="overflow:auto">
              <table aria-label="Resultados de pesquisa" id="resultados">
                <thead>
                  <tr>
                    <th>Nome da Conta</th>
                    <th>CPF/CNPJ</th>
                    <th>Banco</th>
                    <th>Chave Pix (Exemplo)</th>
                    <th>Total de Den√∫ncias</th>
                  </tr>
                </thead>
                <tbody id="tbody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <section id="faq" class="page card" aria-labelledby="h-faq">
          <h1 id="h-faq">FAQ</h1>
          <div class="grid" style="max-width:980px; margin:0 auto">
            <details>
              <summary><strong>Meu Pix aparece denunciado, como posso contestar?</strong></summary>
              <p>R: Envie um e-mail para <a href="mailto:deolhonopix@gmail.com">deolhonopix@gmail.com</a>. Responderemos com orienta√ß√µes.</p>
            </details>
            <details>
              <summary><strong>A minha den√∫ncia √© segura?</strong></summary>
              <p>R: Sim. Suas informa√ß√µes n√£o s√£o expostas publicamente.</p>
            </details>
            <details>
              <summary><strong>Em quanto tempo minha den√∫ncia √© processada?</strong></summary>
              <p>R: Sua den√∫ncia √© processada de imediato e j√° fica dispon√≠vel na nossa comunidade.</p>
            </details>
            <details>
              <summary><strong>Como eu fa√ßo um boletim de ocorr√™ncia?</strong></summary>
              <p>Acesse: <a href="https://www.delegaciaeletronica.policiacivil.sp.gov.br/ssp-de-cidadao/home" target="_blank" rel="noopener">Delegacia Eletr√¥nica ‚Äî SP</a>.</p>
            </details>
          </div>
        </section>

        <section id="recuperar" class="page card">
          <h1 id="h-recuperar">Recuperar senha</h1>
          <form id="form-recuperar" style="max-width:560px; margin:0 auto" novalidate>
            <label>
              <span>E-mail cadastrado<span class="req">*</span></span>
              <input id="recov-email" type="email" required placeholder="voce@exemplo.com" aria-invalid="false" />
              <small class="error">Informe um e-mail v√°lido.</small>
            </label>
            <div class="actions" style="justify-content:center">
              <button class="btn primary" type="submit">Enviar link</button>
              <button class="btn ghost" type="button" onclick="window.location.hash='#/inicio'">Voltar</button>
            </div>
          </form>
        </section>

        <section id="resetar" class="page card">
          <h1>Criar Nova Senha</h1>
          <form id="form-resetar" style="max-width:500px; margin:0 auto" novalidate>
            <label>
              <span>Nova Senha<span class="req">*</span></span>
              <input id="reset-pass" type="password" required minlength="6" placeholder="M√≠nimo 6 caracteres" />
              <small class="error">M√≠nimo 6 caracteres.</small>
            </label>
            <label>
              <span>Confirmar Senha<span class="req">*</span></span>
              <input id="reset-confirm" type="password" required placeholder="Repita a senha" />
              <small class="error">As senhas n√£o coincidem.</small>
            </label>
            <div class="actions" style="justify-content:center">
              <button class="btn primary" type="submit">Alterar Senha</button>
            </div>
          </form>
        </section>

        <section id="perfil" class="page card" aria-labelledby="h-perfil">
          <h1 id="h-perfil">Meu perfil</h1>
          <p class="muted">Atualize seus dados. Campos com <span class="req">*</span> s√£o obrigat√≥rios.</p>
          <form id="form-perfil" style="max-width:800px; margin:0 auto" novalidate>
          <label>
            <span>Nome Completo<span class="req">*</span></span>
            <input id="prof-nome" type="text" required placeholder="Seu nome completo" aria-invalid="false" disabled />
            <small class="error">Informe seu nome.</small>
          </label>

          <label>
            <span>E-mail<span class="req">*</span></span>
            <input id="prof-email" type="email" required placeholder="voce@exemplo.com" aria-invalid="false" disabled />
            <small class="error">Informe um e-mail v√°lido.</small>
          </label>
          <label>
            <span>Telefone<span class="req">*</span></span>
            <input id="prof-tel" type="tel" required inputmode="tel" placeholder="(00) 00000-0000" aria-invalid="false" disabled />
            <small class="error">Informe um telefone v√°lido.</small>
          </label>
          <label>
            <span>Nova senha</span>
            <input id="prof-pass" type="password" minlength="6" placeholder="Opcional ‚Äî deixe em branco para manter" aria-invalid="false" disabled />
            <small class="hint">Se quiser trocar, informe pelo menos 6 caracteres.</small>
          </label>

          <div class="actions" style="justify-content:center">
            <button class="btn primary" type="submit" id="btn-salvar-perfil" style="display: none;">Salvar altera√ß√µes</button>
            <button class="btn ghost" type="button" id="btn-editar-perfil">Editar Perfil</button>
            <button class="btn ghost" type="button" id="btn-cancelar-perfil" style="display: none;">Cancelar</button>

            <button id="btn-logout" class="btn ghost" type="button">Sair</button>
          </div>
        </form>
        </section>
      </main>
    </div>

    <footer role="contentinfo">
      <div class="foot">
        <div>¬© 2025 De Olho no Pix ¬∑ <a href="#/faq" data-route>FAQ</a></div>
      </div>
    </footer>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true">Tudo certo.</div>

  <script>
    /**********************
     * CONFIG E HELPERS   *
     **********************/
    const API_BASE = 'http://localhost:8000/api';

    // Prefer√™ncias de tema e elementos globais
    const body = document.body;
    const btnDark = document.getElementById('btn-dark');
    const btnContrast = document.getElementById('btn-contrast');
    
    // Elementos do Perfil (Globais)
    const formPerfil = document.getElementById('form-perfil');
    const btnSalvarPerfil = document.getElementById('btn-salvar-perfil');
    const btnEditarPerfil = document.getElementById('btn-editar-perfil');
    const btnCancelarPerfil = document.getElementById('btn-cancelar-perfil');
    const profNome = document.getElementById('prof-nome');
    const profEmail = document.getElementById('prof-email');
    const profTel = document.getElementById('prof-tel');
    const profPass = document.getElementById('prof-pass');

    const savedDark = localStorage.getItem('mode-dark') === 'true';
    const savedDal  = localStorage.getItem('mode-daltonico') === 'true';
    if(savedDark) body.classList.add('dark');
    if(savedDal)  body.classList.add('daltonico');

    function setDark(on){
      body.classList.toggle('dark', !!on);
      if(on){ body.classList.remove('daltonico'); localStorage.setItem('mode-daltonico','false'); }
      localStorage.setItem('mode-dark', on ? 'true' : 'false');
    }
    function setDal(on){
      body.classList.toggle('daltonico', !!on);
      if(on){ body.classList.remove('dark'); localStorage.setItem('mode-dark','false'); }
      localStorage.setItem('mode-daltonico', on ? 'true' : 'false');
    }
    btnDark?.addEventListener('click', ()=> setDark(!body.classList.contains('dark')));
    btnContrast?.addEventListener('click', ()=> setDal(!body.classList.contains('daltonico')));

    // Utilit√°rios
    function onlyDigits(v){return (v||'').replace(/\D+/g,'');}
    function maskMoney(el){
      let v = onlyDigits(el.value);
      if(!v){ el.value=''; return; }
      v = (parseInt(v,10)||0).toString().padStart(3,'0');
      const cents = v.slice(-2);
      const int = v.slice(0,-2);
      const intFmt = int.replace(/\B(?=(\d{3})+(?!\d))/g,'.');
      el.value = `${intFmt},${cents}`;
    }

    // --- NOVAS M√ÅSCARAS ---
    function maskCPF(v){ 
      v = v.replace(/\D/g,""); 
      v = v.slice(0,11);
      return v.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4")
              .replace(/^(\d{3})(\d{3})(\d{3})/, "$1.$2.$3")
              .replace(/^(\d{3})(\d{3})/, "$1.$2");
    }

    function maskCNPJ(v){
      v = v.replace(/\D/g,""); 
      v = v.slice(0,14);
      return v.replace(/^(\d{2})(\d)/, "$1.$2")
              .replace(/^(\d{2})\.(\d{3})(\d)/, "$1.$2.$3")
              .replace(/\.(\d{3})(\d)/, ".$1/$2")
              .replace(/(\d{4})(\d)/, "$1-$2");
    }

    function maskTEL(v){
      v = v.replace(/\D/g,""); 
      v = v.slice(0,11);
      if(v.length > 10) {
        return v.replace(/^(\d{2})(\d{5})(\d{4}).*/, "($1) $2-$3");
      } else if (v.length > 6) {
        return v.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, "($1) $2-$3");
      } else if (v.length > 2) {
        return v.replace(/^(\d{2})(\d{0,5}).*/, "($1) $2");
      }
      return v;
    }
    
    function validateEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    // --- APLICA√á√ÉO DE M√ÅSCARAS E RESTRI√á√ïES ---
    const cpf = document.getElementById('cpf');
    const tel = document.getElementById('tel');
    const ag  = document.getElementById('ag');
    const cc  = document.getElementById('cc');
    const valor = document.getElementById('valor');
    const inputNome = document.getElementById('nome');
    const inputDocParcial = document.getElementById('docparcial');
    
    if(cpf){ cpf.addEventListener('input', (e)=>{ e.target.value = maskCPF(e.target.value); }); }
    if(tel){ tel.addEventListener('input', (e)=>{ e.target.value = maskTEL(e.target.value); }); }
    if(valor){ valor.addEventListener('input', ()=>maskMoney(valor)); }

    // CORRE√á√ÉO: Ag√™ncia e Conta (Permite n√∫meros, tra√ßo e barra)
    function validarAgenciaConta(e) {
       // Substitui tudo que N√ÉO for n√∫mero (0-9), tra√ßo (-) ou barra (/) por vazio
       e.target.value = e.target.value.replace(/[^0-9\-\/]/g, '');
    }
    if(ag) ag.addEventListener('input', validarAgenciaConta);
    if(cc) cc.addEventListener('input', validarAgenciaConta);

    // NOME: Remove n√∫meros
    if(inputNome) {
      inputNome.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/[0-9]/g, '');
      });
    }

    // CPF/CNPJ (parcial): Remove letras
    if(inputDocParcial) {
      inputDocParcial.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/[a-zA-Z]/g, '');
      });
    }

    // Toast helper
    const toast = document.getElementById('toast');
    function showToast(msg, type='success'){ if(!toast) return; toast.textContent = msg; toast.classList.remove('error','success'); toast.classList.add(type==='error'?'error':'success'); toast.classList.add('show'); setTimeout(()=> toast.classList.remove('show'), 3000); }

    // Autoriza√ß√£o
    function authHeaders(extra={}){
      const t = localStorage.getItem('pix-token');
      return {
        'Accept': 'application/json',
        ...(extra||{}),
        ...(t ? { 'Authorization': `Bearer ${t}` } : {})
      };
    }

    // --- FUN√á√ÉO DE LOGOUT DE EMERG√äNCIA ---
    function forceLogout() {
      localStorage.removeItem('pix-token');
      window.location.hash = '#/inicio';
      showToast('Sua sess√£o expirou. Entre novamente.', 'error');
    }

    /*****************************
     * L√ìGICA DA CHAVE PIX       *
     *****************************/
    const selectTipo = document.getElementById('tipo');
    const inputChave = document.getElementById('chave_pix');
    const errChave = document.getElementById('err-chave');

    function validarChavePix() {
        if (!selectTipo || !inputChave) return false;
        
        const tipo = selectTipo.value;
        let valor = inputChave.value;
        let valido = true;
        let msg = '';

        if (tipo === 'Telefone') {
            inputChave.value = maskTEL(valor);
            if (onlyDigits(inputChave.value).length < 10) {
                valido = false; msg = 'Telefone incompleto.';
            }
        } else if (tipo === 'CPF') {
            inputChave.value = maskCPF(valor);
            if (onlyDigits(inputChave.value).length < 11) {
                valido = false; msg = 'CPF incompleto.';
            }
        } else if (tipo === 'CNPJ') {
            inputChave.value = maskCNPJ(valor);
            if (onlyDigits(inputChave.value).length < 14) {
                valido = false; msg = 'CNPJ incompleto.';
            }
        } else if (tipo === 'E-mail') {
            if (!validateEmail(valor)) {
                valido = false; msg = 'E-mail inv√°lido.';
            }
        } else if (tipo === 'Chave aleat√≥ria') {
             if (valor.length < 5) {
                valido = false; msg = 'Chave muito curta.';
             }
        }

        // Exibir erro
        if (!valido && valor.length > 0) {
            inputChave.classList.add('field-error');
            inputChave.setAttribute('aria-invalid', 'true');
            if (errChave) {
                errChave.textContent = msg;
                errChave.classList.add('show');
            }
        } else {
            inputChave.classList.remove('field-error');
            inputChave.setAttribute('aria-invalid', 'false');
            if (errChave) errChave.classList.remove('show');
            if (valor.length === 0) valido = false; 
        }
        return valido;
    }

    if (selectTipo && inputChave) {
        selectTipo.addEventListener('change', () => {
            inputChave.value = '';
            inputChave.disabled = false;
            inputChave.classList.remove('field-error');
            if(errChave) errChave.classList.remove('show');

            const tipo = selectTipo.value;
            // Define teclado no celular
            if (['Telefone', 'CPF', 'CNPJ'].includes(tipo)) {
                inputChave.setAttribute('inputmode', 'numeric');
            } else if (tipo === 'E-mail') {
                inputChave.setAttribute('inputmode', 'email');
            } else {
                inputChave.setAttribute('inputmode', 'text');
            }

            if(tipo === 'Telefone') inputChave.placeholder = '(11) 99999-9999';
            else if(tipo === 'CPF') inputChave.placeholder = '000.000.000-00';
            else if(tipo === 'CNPJ') inputChave.placeholder = '00.000.000/0000-00';
            else if(tipo === 'E-mail') inputChave.placeholder = 'exemplo@email.com';
            else if(tipo === 'Chave aleat√≥ria') inputChave.placeholder = 'Cole a chave aqui';
            else { inputChave.disabled = true; inputChave.placeholder = 'Selecione o tipo primeiro'; }
        });

        inputChave.addEventListener('input', validarChavePix);
    }

    /**********************
     * DEN√öNCIA (POST)    *
     **********************/
    const formDen = document.getElementById('form-denuncia');
    formDen?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      
      if (selectTipo.value && !validarChavePix()) {
         showToast('Corrija a Chave Pix antes de enviar.', 'error');
         inputChave.focus();
         return;
      }

      const tipo = document.getElementById('tipo');
      const nome = document.getElementById('nome');
      const docp = document.getElementById('docparcial'); 
      const banco= document.getElementById('banco');     
      const bo = document.getElementById('bo');         
      const boFile = document.getElementById('bo-file');
      
      const agi  = document.getElementById('ag');
      const cci  = document.getElementById('cc');
      const val  = document.getElementById('valor');
      const desc = document.getElementById('desc');

      const required = [tipo, nome, inputChave, docp, banco, bo, boFile];
      let ok = true;
      required.forEach(el=>{
        if (!el) return; 
        const valid = (el.type==='file') ? (el.files && el.files.length>0) : !!el.value;
        if(!valid){ 
          el.classList.add('field-error'); 
          el.setAttribute('aria-invalid','true'); 
          ok=false; 
        } else { 
          el.classList.remove('field-error'); 
          el.setAttribute('aria-invalid','false'); 
        }
      });

      if(!ok){ showToast('Preencha os campos obrigat√≥rios.', 'error'); return; }

      const fd = new FormData();
      fd.append('anexo', boFile.files[0]);
      fd.append('tipo_chave_pix', tipo.value);
      fd.append('nome_conta', nome.value);
      fd.append('chave_pix', inputChave.value);
      fd.append('numero_bo', bo.value);
      fd.append('cpf_cnpj', docp.value);
      fd.append('banco', banco.value);

      if(agi && agi.value) fd.append('agencia', agi.value);
      if(cci && cci.value) fd.append('conta', cci.value);
      if(desc && desc.value) fd.append('descricao', desc.value);
      if(val && val.value) fd.append('valor', val.value);

      try{
        showToast('Enviando den√∫ncia...', 'success');
        const resp = await fetch(`${API_BASE}/denuncias`, {
          method: 'POST',
          headers: authHeaders(),
          body: fd
        });
        
        if(resp.status === 401) { forceLogout(); return; }

        const data = await resp.json().catch(()=>({}));
        if(!resp.ok){ throw new Error(data.detail || 'Erro desconhecido no servidor'); }
        showToast('Den√∫ncia registrada com sucesso!', 'success');
        formDen.reset();
        inputChave.disabled = true; 
        inputChave.placeholder = 'Selecione o tipo primeiro';
        
        window.location.hash = '#/pesquisar';
        await doSearch();
      }catch(err){
        console.error('Falha ao enviar den√∫ncia:', err);
        showToast(`Erro: ${err.message}`, 'error');
      }
    });

    /**********************
     * ROTEAMENTO E NAV   *
     **********************/
    function setActive(slug){
      const routes = ["inicio","cadastro","hub","denunciar","pesquisar","faq","recuperar","perfil","resetar"];
      routes.forEach(id=>{
        const el = document.getElementById(id);
        if(!el) return;
        el.classList.toggle('active', id===slug);
      });
      document.querySelectorAll('[data-route]').forEach(a=>{
        const dest = (a.getAttribute('href')||'').replace(/^#\//,'');
        a.setAttribute('aria-current', dest===slug ? 'page' : 'false');
      });
      const nav = document.querySelector('.topnav');
      const navPerfil = document.getElementById('nav-perfil');
      const logged = !!localStorage.getItem('pix-token');
      if(nav){
        if(!logged && ['inicio','cadastro','recuperar','faq'].includes(slug)){
          nav.querySelectorAll('a').forEach(a=>{
            const href = a.getAttribute('href');
            a.style.display = href==="#/faq" ? 'inline-flex' : 'none';
          });
          if(logged && navPerfil) navPerfil.style.display = 'inline-flex';
        } else if(['inicio','cadastro','recuperar'].includes(slug)){
          nav.querySelectorAll('a').forEach(a=>{
            const href = a.getAttribute('href');
            a.style.display = href==="#/faq" ? 'inline-flex' : 'none';
          });
          if(logged && navPerfil) navPerfil.style.display = 'inline-flex';
        } else {
          nav.querySelectorAll('a').forEach(a=> a.style.display = 'inline-flex');
          if(!logged && navPerfil) navPerfil.style.display = 'none';
        }
      }
    }
    const routes = ["inicio","cadastro","hub","denunciar","pesquisar","faq","recuperar","perfil","resetar"];

    // 2. Fun√ß√£o para pegar a p√°gina atual (Ignora o ?token=...)
    function currentSlug(){
      const h = window.location.hash || '#/inicio';
      // Pega apenas a parte antes do '?' e remove o '#/'
      const slug = h.replace(/^#\//,'').split('?')[0];
      // Se a rota n√£o existir, volta para inicio
      return routes.includes(slug) ? slug : 'inicio';
    }

    // 3. Fun√ß√£o Principal de Roteamento
    function onRoute(){
       const slug = currentSlug(); // Agora usamos 'slug', n√£o 'hash'
       const logged = !!localStorage.getItem('pix-token');
       
       // Lista de p√°ginas p√∫blicas (incluindo a nova 'resetar')
       const publicas = ['inicio','cadastro','recuperar','resetar'];
       
       // L√≥gica de Seguran√ßa:
       // Se logado tenta ir pra p√∫blica -> manda pro hub
       if(logged && publicas.includes(slug)) { 
           window.location.hash = '#/hub'; 
           return; 
       }
       
       // Se deslogado tenta ir pra privada -> manda pra login
       if(!logged && !publicas.includes(slug)) { 
           window.location.hash = '#/inicio'; 
           return; 
       }

       // Atualiza a UI (Esconde/Mostra se√ß√µes)
       document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
       const target = document.getElementById(slug);
       if(target) target.classList.add('active');
       
       // Atualiza links de navega√ß√£o
       document.querySelectorAll('nav a').forEach(a => {
          // Removemos o ?token da compara√ß√£o visual tamb√©m
          const hrefSlug = (a.getAttribute('href') || '').replace('#/','');
          if(hrefSlug === slug) a.style.color = 'var(--brand-accent)';
          else a.style.color = 'var(--muted)';
       });

       // Controle do menu Perfil
       const navPerfil = document.getElementById('nav-perfil');
       if(navPerfil) navPerfil.style.display = logged ? 'inline-block' : 'none';

       // Carrega dados espec√≠ficos da p√°gina
       if(slug === 'perfil') loadProfile();
       if(slug === 'pesquisar') doSearch();
    }

    window.addEventListener('hashchange', onRoute);

    /**********************
     * RENDER PESQUISA    *
     **********************/
    let lastResults = [];

    function renderTable(rows){
      const tbody = document.getElementById('tbody'); if(!tbody) return; tbody.innerHTML = '';
      if(!rows || !rows.length){
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 20px;">Nenhuma den√∫ncia encontrada.</td></tr>';
        return;
      }
      rows.forEach(r => {
        const nome = r.nome_conta || '‚Äî';
        const doc  = r.cpf_cnpj || '‚Äî';
        const banco= r.banco || '‚Äî';
        const chave = (r.chave_pix_exemplo || '‚Äî').replace(/\n/g, '<br>');
        const denunciasNum = Number(r.total_denuncias || 0);
        
        let riskClass = 'risk-5';
        if(denunciasNum >= 15) riskClass = 'risk-15'; 
        else if(denunciasNum >= 10) riskClass = 'risk-10'; 
        else if(denunciasNum >= 5) riskClass = 'risk-5'; 
        
        const tr = document.createElement('tr');
        tr.className = riskClass;
        tr.innerHTML = `
          <td>${nome}</td>
          <td>${doc}</td>
          <td>${banco}</td>
          <td>${chave}</td>
          <td><span class="badge" style="font-size: 14px;">${denunciasNum}</span></td>`;
        tbody.appendChild(tr);
      });
    }

    /**********************
     * BUSCA & SUGEST√ïES  *
     **********************/
    const q = document.getElementById('q');
    const sugList = document.getElementById('sug-list');
    const filtroTipo = document.getElementById('filtro-tipo');

    function buildSuggestions(term){
      if(!q || !sugList) return;
      const t = (term||'').toLowerCase();
      if(!t || !lastResults.length){
        sugList.innerHTML = '';
        sugList.classList.remove('show');
        q.setAttribute('aria-expanded','false');
        return;
      }
      const pool = new Set();
      lastResults.forEach(r=>{
        ['nome_conta', 'banco', 'cpf_cnpj', 'chave_pix_exemplo'].forEach(k=>{
          const v = String(r[k]||'');
          if(v.toLowerCase().includes(t)) pool.add(v);
        });
      });
      const list = Array.from(pool).slice(0,8);
      if(!list.length){
        sugList.innerHTML='';
        sugList.classList.remove('show');
        q.setAttribute('aria-expanded','false');
        return;
      }
      sugList.innerHTML = list.map(v=>`<div class="suggestion-item" role="option">${v}</div>`).join('');
      sugList.classList.add('show'); q.setAttribute('aria-expanded','true');
    }
    sugList?.addEventListener('click', (e)=>{ const it = e.target.closest('.suggestion-item'); if(!it) return; q.value = it.textContent; doSearch(); sugList.classList.remove('show'); q.setAttribute('aria-expanded','false'); });
    document.addEventListener('click', (e)=>{ if(!sugList.contains(e.target) && e.target!==q){ sugList.classList.remove('show'); q?.setAttribute('aria-expanded','false'); } });

    async function doSearch(){
      const term = (q?.value||'').trim();
      const tipoSel = (filtroTipo?.value||'');
      try{
        const url = new URL(`${API_BASE}/denuncias`);
        if(term) url.searchParams.append('q', term);
        if(tipoSel) url.searchParams.append('tipo', tipoSel);
        const resp = await fetch(url, { headers: authHeaders() });
        
        if(resp.status === 401) { forceLogout(); return; }

        if(!resp.ok){ throw new Error('Falha ao buscar den√∫ncias'); }
        const data = await resp.json();
        lastResults = Array.isArray(data) ? data : [];
        renderTable(lastResults);
      }catch(err){
        console.error(err);
        showToast('Erro ao conectar ao servidor.', 'error');
      }
    }

    const btnBuscar = document.getElementById('btn-buscar');
    const btnLimpar = document.getElementById('btn-limpar');
    btnBuscar?.addEventListener('click', doSearch);
    btnLimpar?.addEventListener('click', ()=>{
      if(q){ q.value=''; }
      if(filtroTipo){ filtroTipo.value=''; localStorage.removeItem('filtro-tipo'); }
      lastResults = [];
      renderTable(lastResults);
    });
    q?.addEventListener('input', ()=>{ buildSuggestions(q.value); });
    q?.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); doSearch(); sugList.classList.remove('show'); q.setAttribute('aria-expanded','false'); } });
    filtroTipo?.addEventListener('change', ()=>{
      localStorage.setItem('filtro-tipo', filtroTipo.value||'');
      doSearch();
    });

    /**********************
     * LOGIN / LOGOUT     *
     **********************/
    async function loadProfile() {
      try {
        const resp = await fetch(`${API_BASE}/me`, { headers: authHeaders() });
        
        if(resp.status === 401) { forceLogout(); return; }

        if (!resp.ok) throw new Error('Falha ao carregar perfil');
        const user = await resp.json(); 
        
        profNome.value = user.nome || '';
        profEmail.value = user.email || '';
        profTel.value = user.telefone || '';
        if (profTel.value) profTel.value = maskTEL(profTel.value);

        toggleEditProfile(false); 
      } catch (err) {
        console.error(err);
        showToast(err.message, 'error');
        window.location.hash = '#/hub'; 
      }
    }

    // 5. Recuperar Senha (NOVO)
    document.getElementById('form-recuperar')?.addEventListener('submit', async e => {
      e.preventDefault();
      const emailInput = document.getElementById('recov-email');
      
      if(!emailInput.value || !emailInput.checkValidity()){
         showToast('Digite um e-mail v√°lido.', 'error');
         return;
      }

      try {
        showToast('Enviando e-mail...', 'success'); // Feedback imediato
        
        const resp = await fetch(`${API_BASE}/password-recovery`, {
           method: 'POST', 
           headers: {'Content-Type':'application/json'},
           body: JSON.stringify({ email: [emailInput.value] }) // A lib espera uma lista
        });
        
        const data = await resp.json();
        
        if(!resp.ok) throw new Error(data.detail || 'Erro ao enviar e-mail');
        
        showToast('Verifique sua caixa de entrada!', 'success');
        emailInput.value = ''; // Limpa o campo
        
        // Opcional: Voltar para o login ap√≥s alguns segundos
        setTimeout(() => window.location.hash = '#/inicio', 3000);

      } catch(err) { 
        console.error(err);
        showToast('Erro ao tentar recuperar senha.', 'error'); 
      }
    });

    function toggleEditProfile(isEditing) {
      profNome.disabled = !isEditing;
      profEmail.disabled = !isEditing;
      profTel.disabled = !isEditing;
      profPass.disabled = !isEditing;
      
      btnSalvarPerfil.style.display = isEditing ? 'inline-flex' : 'none';
      btnCancelarPerfil.style.display = isEditing ? 'inline-flex' : 'none';
      btnEditarPerfil.style.display = isEditing ? 'none' : 'inline-flex';
      
      if (isEditing) {
        profNome.focus(); 
      } else {
        profPass.value = ''; 
      }
    }
    
    btnEditarPerfil?.addEventListener('click', () => toggleEditProfile(true));
    btnCancelarPerfil?.addEventListener('click', () => {
      loadProfile(); 
    });

    const formLogin = document.getElementById('form-login');
    formLogin?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('login-email');
      const pass = document.getElementById('login-pass');
      let ok = true;
      if(!email.value || !email.checkValidity()){ email.classList.add('field-error'); document.getElementById('err-login-email')?.classList.add('show'); email.setAttribute('aria-invalid','true'); ok=false; } else { email.classList.remove('field-error'); document.getElementById('err-login-email')?.classList.remove('show'); email.setAttribute('aria-invalid','false'); }
      if(!pass.value || pass.value.length<6){ pass.classList.add('field-error'); document.getElementById('err-login-pass')?.classList.add('show'); pass.setAttribute('aria-invalid','true'); ok=false; } else { pass.classList.remove('field-error'); document.getElementById('err-login-pass')?.classList.remove('show'); pass.setAttribute('aria-invalid','false'); }
      if(!ok){ showToast('Preencha os campos obrigat√≥rios.', 'error'); return; }
      try{
        const resp = await fetch(`${API_BASE}/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', ...authHeaders() },
          body: JSON.stringify({ email: email.value, senha: pass.value })
        });
        const data = await resp.json();
        if(!resp.ok){ throw new Error(data.detail || 'E-mail ou senha incorretos'); }
        localStorage.setItem('pix-token', data.access_token || data.token || '');
        document.getElementById('nav-perfil').style.display = 'inline-flex';
        window.location.hash = '#/hub';
        showToast('Login efetuado com sucesso!', 'success');
      }catch(err){
        console.error('Erro no login:', err);
        showToast(`Erro: ${err.message}`, 'error');
      }
    });

    document.getElementById('btn-logout')?.addEventListener('click', ()=>{
      localStorage.removeItem('pix-token');
      document.getElementById('nav-perfil').style.display='none';
      window.location.hash = '#/inicio';
      showToast('Voc√™ saiu da sua conta.', 'success');
    });

    /**********************
     * CADASTRO (REGISTER)*
     **********************/
    const formCad = document.getElementById('form-cadastro');
    formCad?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!formCad.checkValidity()){
        showToast('Preencha os campos obrigat√≥rios.', 'error');
        return;
      }
      const nome = document.getElementById('cad-nome').value;
      const cpfVal = document.getElementById('cpf').value;
      const telefone = document.getElementById('tel').value;
      const email = document.getElementById('cad-email').value;
      const senha = document.getElementById('cad-pass').value;
      try{
        const resp = await fetch(`${API_BASE}/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', ...authHeaders() },
          body: JSON.stringify({
            email,
            nome,
            cpf: onlyDigits(cpfVal),
            telefone: onlyDigits(telefone),
            senha
          })
        });
        const data = await resp.json();
        if(!resp.ok){ throw new Error(data.detail || 'Erro ao cadastrar'); }
        window.location.hash = '#/inicio';
        showToast('Cadastro realizado com sucesso! Agora √© s√≥ entrar.', 'success');
      }catch(err){
        console.error('Erro no cadastro:', err);
        showToast(`Erro: ${err.message}`, 'error');
      }
    });

    /**********************
     * PERFIL (AGORA REAL)*
     **********************/
    formPerfil?.addEventListener('submit', async (e) => { 
      e.preventDefault();
      
      let ok = true;
      if(!profNome.value){ profNome.classList.add('field-error'); profNome.setAttribute('aria-invalid','true'); ok=false; } else { profNome.classList.remove('field-error'); profNome.setAttribute('aria-invalid','false'); }
      if(!profEmail.value || !profEmail.checkValidity()){ profEmail.classList.add('field-error'); profEmail.setAttribute('aria-invalid','true'); ok=false; } else { profEmail.classList.remove('field-error'); profEmail.setAttribute('aria-invalid','false'); }
      if(!profTel.value || onlyDigits(profTel.value).length!==11){ profTel.classList.add('field-error'); profTel.setAttribute('aria-invalid','true'); ok=false; } else { profTel.classList.remove('field-error'); profTel.setAttribute('aria-invalid','false'); }
      if(profPass.value && profPass.value.length<6){ profPass.classList.add('field-error'); profPass.setAttribute('aria-invalid','true'); ok=false; } else { profPass.classList.remove('field-error'); profPass.setAttribute('aria-invalid','false'); }
      
      if(!ok){ showToast('Corrija os campos destacados.', 'error'); return; }

      const updateData = {
        nome: profNome.value,
        email: profEmail.value,
        telefone: onlyDigits(profTel.value)
      };
      
      if (profPass.value) {
        updateData.senha = profPass.value;
      }
      
      try {
        const resp = await fetch(`${API_BASE}/me`, {
          method: 'PATCH', 
          headers: authHeaders({ 'Content-Type': 'application/json' }),
          body: JSON.stringify(updateData)
        });
        
        if(resp.status === 401) { forceLogout(); return; }

        const data = await resp.json();
        if (!resp.ok) {
          throw new Error(data.detail || 'Erro ao salvar perfil');
        }
        
        showToast('Perfil atualizado com sucesso!', 'success');
        toggleEditProfile(false); 
        
      } catch (err) {
        console.error(err);
        showToast(`Erro: ${err.message}`, 'error');
        loadProfile(); 
      }
    });

    window.addEventListener('DOMContentLoaded', ()=>{
      const savedFiltro = localStorage.getItem('filtro-tipo') || '';
      const filtroTipoEl = document.getElementById('filtro-tipo');
      if(filtroTipoEl){ filtroTipoEl.value = savedFiltro; }
      
      onRoute();
    });

    // 6. Resetar Senha (Final)
    document.getElementById('form-resetar')?.addEventListener('submit', async e => {
      e.preventDefault();
      const p1 = document.getElementById('reset-pass');
      const p2 = document.getElementById('reset-confirm');
      
      // Valida√ß√£o simples
      if(p1.value.length < 6) {
          showToast('A senha deve ter no m√≠nimo 6 caracteres.', 'error');
          return;
      }
      if(p1.value !== p2.value) {
          showToast('As senhas n√£o conferem.', 'error');
          return;
      }

      // Pega o token da URL (ex: ...#/resetar?token=XYZ...)
      const params = new URLSearchParams(window.location.hash.split('?')[1]);
      const token = params.get('token');

      if(!token) {
          showToast('Link inv√°lido ou sem token.', 'error');
          return;
      }

      try {
        const resp = await fetch(`${API_BASE}/reset-password`, {
           method: 'POST', 
           headers: {'Content-Type':'application/json'},
           body: JSON.stringify({ token: token, new_password: p1.value })
        });
        
        const data = await resp.json();
        
        if(!resp.ok) throw new Error(data.detail || 'Erro ao alterar senha');
        
        showToast('Senha alterada com sucesso!', 'success');
        
        // Redireciona para o login
        setTimeout(() => window.location.hash = '#/inicio', 2000);

      } catch(err) { 
        console.error(err);
        showToast(err.message, 'error'); 
      }
    });
  </script>
</body>
</html>